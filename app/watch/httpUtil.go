package watch

const webJs = `var zWatchJs=[],zWatchCss={},zwatchWs;!function(){document.addEventListener("DOMContentLoaded",function(t){var e=document.createElement("a"),o="";document.querySelectorAll("script").forEach(function(t){t.src&&(e.href=t.src,o=e.href,zWatchJs.push(o.replace(location.origin+"/","")))}),document.querySelectorAll("link").forEach(function(t){t.href&&(e.href=t.href,zWatchCss[e.pathname.substring(1)]=t)})});var t=function(){try{var e=location.host;zwatchWs=new WebSocket("ws://"+e+"/"),zwatchWs.onopen=function(t){},zwatchWs.onmessage=function(t){var e=JSON.parse(t.data);console.log("update: ",e.Name);for(var o=0,a=zWatchJs.length;o<a;o++)if(zWatchJs[o]===e.Name)return void location.reload();for(var c in zWatchCss)if(c===e.Name&&zWatchCss.hasOwnProperty(c)){var n=zWatchCss[c].href;return zWatchCss[c].href="",void(zWatchCss[c].href=n)}location.pathname==="/"+e.Name&&location.reload()},zwatchWs.onclose=function(e){console.warn("Disconnect from zwatch."),setTimeout(function(){t()},300)}}catch(t){}};t()}();`

const vueSpaJs = `"use strict";var zwatchWs,_SpaForChildren,SpaResource={sta:{},mod:{}};!function(){var e=[],n=[];document.querySelectorAll("link").forEach(function(e){var o=e.href;o&&n.push([o.replace(location.origin,""),e])}),document.querySelectorAll("script").forEach(function(n){var o=n.src;o&&e.push(o.replace(location.origin,""))});var o=function(e){for(var o in n)if(n.hasOwnProperty(o)&&n[o][0]===e)return void(n[o][1].href=e+"?v="+ +new Date)},
a=function(n){for(var o in e)if(e.hasOwnProperty(o)&&e[o]===n)return void location.reload()},r={sta:{},mod:{}},t=function(e){return 0!==e.indexOf("/")&&(e="/"+e),e},i=function(e){var n=r.mod[e],o=r.sta;if(delete r.mod[e],n){var a=!0,t=!1,i=void 0;try{for(var c,f=n[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){var u=c.value,l=o[u]||[];if(l.length>1){var s=l.indexOf(e);l.splice(s,1)}else delete o[u]}}catch(e){t=!0,i=e}finally{try{!a&&f.return&&f.return()}finally{if(t)throw i}}}},c=function(e,
n){!0===n?n=SpaResource.mod[e]||[]:SpaResource.mod[e]=n,r.mod[e]=n;var o=r.sta,a={},i=!0,c=!1,f=void 0;try{for(var u,l=n[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var s=u.value;s=t(s);var d=o[s]||[];d.indexOf(e)>=0||(d.push(e),a[s]=d)}}catch(e){c=!0,f=e}finally{try{!i&&l.return&&l.return()}finally{if(c)throw f}}Object.assign(o,a),Object.assign(SpaResource.sta,a)},f=function(){(_SpaForChildren=function(e,n){for(var o=e.length,a=0;a<o;a++){var r=e[a];r&&n&&setTimeout(function(){r.$vnode.context.$forceUpdate()}),_SpaForChildren(r.$children,n)}})(Spa.vue.$children,1)};window._SpaModGet=function(e,n){!1===n?i(e):c(e,n)},window.Spa?function e(){try{var n=location.host;zwatchWs=new WebSocket("ws://"+n+"/"),zwatchWs.onopen=function(e){},zwatchWs.onmessage=function(e){var n=JSON.parse(e.data);if(console.log("update: ",n.Name),n.Name){0!==n.Name.indexOf("/")&&(n.Name="/"+n.Name);var r=Spa.baseUrl;0!==r.indexOf("/")&&(r="/"+r);var t=new RegExp(r+"(.*)"+Spa.suffix,"g").exec(n.Name);if(t)Spa.loadMod(t[1],!0).then(function(){f()});else{var i=SpaResource.sta[n.Name];i?(i=i.map(function(e){return e.replace(/_/g,"/")}),Spa.loadMod(i,!0).then(function(){f()})):(a(n.Name),o(n.Name))}}},zwatchWs.onclose=function(n){console.warn("Disconnect from zwatch."),setTimeout(function(){e()},300)}}catch(e){}}():function(){` + webJs + `}()}();
`
