/*
 * @Author: seekwe
 * @Date: 2020-07-03 19:28:53
 * @Last Modified by:: seekwe
 * @Last Modified time: 2020-07-06 12:42:29
 */
package watch

const webJs = `var zWatchJs=[],zWatchCss={},zwatchWs;!function(){document.addEventListener("DOMContentLoaded",function(t){var e=document.createElement("a"),o="";document.querySelectorAll("script").forEach(function(t){t.src&&(e.href=t.src,o=e.href,zWatchJs.push(o.replace(location.origin+"/","")))}),document.querySelectorAll("link").forEach(function(t){t.href&&(e.href=t.href,zWatchCss[e.pathname.substring(1)]=t)})});var t=function(){try{var e=location.host;zwatchWs=new WebSocket("ws://"+e+"/"),zwatchWs.onopen=function(t){},zwatchWs.onmessage=function(t){var e=JSON.parse(t.data);console.log("update: ",e.Name);for(var o=0,a=zWatchJs.length;o<a;o++)if(zWatchJs[o]===e.Name)return void location.reload();for(var c in zWatchCss)if(c===e.Name&&zWatchCss.hasOwnProperty(c)){var n=zWatchCss[c].href;return zWatchCss[c].href="",void(zWatchCss[c].href=n)}location.pathname==="/"+e.Name&&location.reload()},zwatchWs.onclose=function(e){console.warn("Disconnect from zwatch."),setTimeout(function(){t()},300)}}catch(t){}};t()}();`

const vueSpaJs = `"use strict";var zwatchWs,_SpaForChildren,SpaResource={sta:{},mod:{}};!function(){var e=[],n=[];document.querySelectorAll("link").forEach(function(e){var o=e.href;o&&n.push([o.replace(location.origin,""),e])}),document.querySelectorAll("script").forEach(function(n){var o=n.src;o&&e.push(o.replace(location.origin,""))});var o=function(e){for(var o in n)if(n.hasOwnProperty(o)&&n[o][0]===e)return void(n[o][1].href=e+"?v="+ +new Date)},
a=function(n){for(var o in e)if(e.hasOwnProperty(o)&&e[o]===n)return void location.reload()},r={sta:{},mod:{}},t=function(e){return 0!==e.indexOf("/")&&(e="/"+e),e},i=function(e){var n=r.mod[e],o=r.sta;if(delete r.mod[e],n){var a=!0,t=!1,i=void 0;try{for(var c,f=n[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){var u=c.value,l=o[u]||[];if(l.length>1){var s=l.indexOf(e);l.splice(s,1)}else delete o[u]}}catch(e){t=!0,i=e}finally{try{!a&&f.return&&f.return()}finally{if(t)throw i}}}},c=function(e,
n){!0===n?n=SpaResource.mod[e]||[]:SpaResource.mod[e]=n,r.mod[e]=n;var o=r.sta,a={},i=!0,c=!1,f=void 0;try{for(var u,l=n[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var s=u.value;s=t(s);var d=o[s]||[];d.indexOf(e)>=0||(d.push(e),a[s]=d)}}catch(e){c=!0,f=e}finally{try{!i&&l.return&&l.return()}finally{if(c)throw f}}Object.assign(o,a),Object.assign(SpaResource.sta,a)},f=function(){(_SpaForChildren=function(e,n){for(var o=e.length,a=0;a<o;a++){var r=e[a];r&&n&&setTimeout(function(){r.$vnode.context.$forceUpdate()}),_SpaForChildren(r.$children,n)}})(Spa.vue.$children,1)};window._SpaModGet=function(e,n){!1===n?i(e):c(e,n)},window.Spa?function e(){try{var n=location.host;zwatchWs=new WebSocket("ws://"+n+"/"),zwatchWs.onopen=function(e){},zwatchWs.onmessage=function(e){var n=JSON.parse(e.data);if(console.log("update: ",n.Name),n.Name){0!==n.Name.indexOf("/")&&(n.Name="/"+n.Name);var r=Spa.baseUrl;0!==r.indexOf("/")&&(r="/"+r);var t=new RegExp(r+"(.*)"+Spa.suffix,"g").exec(n.Name);if(t)Spa.loadMod(t[1],!0).then(function(){f()});else{var i=SpaResource.sta[n.Name];i?(i=i.map(function(e){return e.replace(/_/g,"/")}),Spa.loadMod(i,!0).then(function(){f()})):(a(n.Name),o(n.Name))}}},zwatchWs.onclose=function(n){console.warn("Disconnect from zwatch."),setTimeout(function(){e()},300)}}catch(e){}}():function(){` + webJs + `}()}();
`

const vueHotReload = `!function(){function e(e){return e?(v.href=e,v.pathname):""}function n(e){var n=e.lastIndexOf(".");return-1!=n?e.substring(n+1,e.length).toLowerCase():""}function o(e,n){if(n.functional){var o=n.render;n.render=function(n,t){var r=f[e].instances;return t&&r.indexOf(t.parent)<0&&r.push(t.parent),o(n,t)}}else t(n,p,function(){var n=f[e];n.Ctor||(n.Ctor=this.constructor),n.instances.push(this)}),t(n,"beforeDestroy",function(){var n=f[e].instances;n.splice(n.indexOf(this),1)})}function t(e,n,o){var t=e[n];e[n]=t?Array.isArray(t)?t.concat(o):[t,o]:[o]}function r(e){return function(n,o){try{e(n,o)}catch(e){console.error(e),console.warn("Something went wrong during Vue component hot-reload. Full reload required.")}}}function i(e,n){for(var o in e)o in n||delete e[o];for(var t in n)e[t]=n[t]}function c(e){if(e._u){var n=e._u;return e._u=function(e){try{return n(e,!0)}catch(o){return n(e,null,!0)}},function(){e._u=n}}}var a,s,u={},f=Object.create(null);window.__VUE_HOT_MAP__=f;var l=!1,d=!1,p="beforeCreate";window.VueRun.debug=u;var h={},v=document.createElement("a"),w=function(){try{var o=location.host;zwatchWs=new WebSocket("ws://"+o+"/"),zwatchWs.onopen=function(e){},zwatchWs.onmessage=function(o){var t=JSON.parse(o.data),r="/"+t.Name,i=n(r);switch(console.log("update: ",r),i){case"vue":VueRun.hotReload(r);break;case"html":var c=location.pathname;"/"==c&&(c="index.html"),r===c&&location.reload();break;case"css":if(h[r])return void(h[r].href=r+"?v="+ +new Date);document.querySelectorAll("link").forEach(function(e){var n=e.href;n&&(n=n.replace(location.origin,""))===r&&(e.href=n+"?v="+ +new Date,h[r]=e)});break;case"es6":case"js":for(var a in VueRun.staticState){e(VueRun.staticState[a])===r&&VueRun.loadEs(r,a,!0)}document.querySelectorAll("script").forEach(function(e){var n=e.src;if(n)return n=n.replace(location.origin,""),n===r?void location.reload():void 0})}},zwatchWs.onclose=function(e){console.warn("Disconnect from zwatch."),setTimeout(function(){w()},300)}}catch(e){}};if(w(),!window.Vue||!window.Vue.use)return void console.warn("[HMR] Vue not found");u.install=function(e,n){if(!l)return l=!0,a=e.__esModule?e.default:e,s=a.version.split(".").map(Number),d=n,a.config._lifecycleHooks.indexOf("init")>-1&&(p="init"),u.compatible=s[0]>=2,u.compatible?void 0:void console.warn("[HMR] You are using a version of vue-hot-reload-api that is only compatible with Vue.js core ^2.0.0.")},u.install(window.Vue),u.createRecord=function(e,n){if(!f[e]){var t=null;"function"==typeof n&&(t=n,n=t.options),o(e,n),f[e]={Ctor:t,options:n,instances:[]}}},u.isRecorded=function(e){return void 0!==f[e]},u.rerender=r(function(e,n){var o=f[e];if(!n)return void o.instances.slice().forEach(function(e){e.$forceUpdate()});if("function"==typeof n&&(n=n.options),o.Ctor)o.Ctor.options.render=n.render,o.Ctor.options.staticRenderFns=n.staticRenderFns,o.instances.slice().forEach(function(e){e.$options.render=n.render,e.$options.staticRenderFns=n.staticRenderFns,e._staticTrees&&(e._staticTrees=[]),Array.isArray(o.Ctor.options.cached)&&(o.Ctor.options.cached=[]),Array.isArray(e.$options.cached)&&(e.$options.cached=[]);var t=c(e);e.$forceUpdate(),e.$nextTick(t)});else if(o.options.render=n.render,o.options.staticRenderFns=n.staticRenderFns,o.options.functional){if(Object.keys(n).length>2)i(o.options,n);else{var t=o.options._injectStyles;if(t){var r=n.render;o.options.render=function(e,n){return t.call(n),r(e,n)}}}o.options._Ctor=null,Array.isArray(o.options.cached)&&(o.options.cached=[]),o.instances.slice().forEach(function(e){e.$forceUpdate()})}}),u.reload=r(function(e,n){var t=f[e];if(n)if("function"==typeof n&&(n=n.options),o(e,n),t.Ctor){s[1]<2&&(t.Ctor.extendOptions=n);var r=t.Ctor.super.extend(n);r.options._Ctor=t.options._Ctor,t.Ctor.options=r.options,t.Ctor.cid=r.cid,t.Ctor.prototype=r.prototype,r.release&&r.release()}else i(t.options,n);t.instances.slice().forEach(function(e){e.$vnode&&e.$vnode.context?e.$vnode.context.$forceUpdate():console.warn("Root or manually mounted instance modified. Full reload required.")})})}();`
